<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | The Digiquarium</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --text-primary: #e0e0e0;
            --text-secondary: #888;
            --accent-cyan: #00d4ff;
            --accent-green: #00ff88;
            --accent-red: #ff4444;
            --accent-yellow: #ffaa00;
            --accent-purple: #aa88ff;
            --accent-orange: #FE6500;
            --border: #2a2a3a;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        
        /* Auth Gate */
        .auth-gate { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-primary); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .auth-gate.hidden { display: none; }
        .auth-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 40px; max-width: 400px; width: 90%; text-align: center; }
        .auth-box h1 { color: var(--accent-cyan); margin-bottom: 10px; }
        .auth-box .subtitle { color: var(--text-secondary); margin-bottom: 30px; font-size: 0.9em; }
        .auth-box input { width: 100%; padding: 15px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 1em; margin-bottom: 15px; }
        .auth-box input:focus { outline: none; border-color: var(--accent-cyan); }
        .auth-box button { width: 100%; padding: 15px; border: none; border-radius: 8px; background: var(--accent-cyan); color: var(--bg-primary); font-size: 1em; font-weight: 600; cursor: pointer; }
        .auth-box button:hover { opacity: 0.8; }
        .auth-error { color: var(--accent-red); margin-top: 15px; font-size: 0.9em; display: none; }
        .auth-error.show { display: block; }
        .security-note { margin-top: 20px; padding: 15px; background: rgba(255, 68, 68, 0.1); border: 1px solid rgba(255, 68, 68, 0.3); border-radius: 8px; font-size: 0.8em; color: var(--text-secondary); }
        .cloudflare-note { margin-top: 15px; padding: 10px; background: rgba(254, 101, 0, 0.1); border: 1px solid var(--accent-orange); border-radius: 6px; font-size: 0.75em; }
        
        /* Dashboard */
        .dashboard { display: none; }
        .dashboard.visible { display: block; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); }
        .header h1 { font-size: 1.5em; color: var(--accent-cyan); }
        .header-controls { display: flex; align-items: center; gap: 15px; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-indicator.healthy { background: var(--accent-green); }
        .status-indicator.warning { background: var(--accent-yellow); }
        .status-indicator.critical { background: var(--accent-red); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Tabs */
        .tabs { display: flex; background: var(--bg-secondary); border-bottom: 1px solid var(--border); padding: 0 30px; }
        .tab { padding: 15px 25px; cursor: pointer; color: var(--text-secondary); border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab:hover { color: var(--text-primary); }
        .tab.active { color: var(--accent-cyan); border-bottom-color: var(--accent-cyan); }
        
        /* Tab Content */
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        
        /* Cards */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .card h2 { font-size: 1em; color: var(--text-secondary); margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .card.full-width { grid-column: 1 / -1; }
        .metric { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .metric:last-child { border-bottom: none; }
        .metric .value { font-family: 'JetBrains Mono', monospace; font-weight: 600; }
        .metric .value.healthy { color: var(--accent-green); }
        .metric .value.critical { color: var(--accent-red); }
        
        /* Daemon Grid */
        .daemon-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
        .daemon { background: var(--bg-secondary); padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
        .daemon:hover { border-color: var(--accent-cyan); }
        .daemon.selected { border-color: var(--accent-cyan); background: rgba(0, 212, 255, 0.1); }
        .daemon .icon { font-size: 1.8em; margin-bottom: 8px; }
        .daemon .name { font-size: 0.8em; color: var(--text-secondary); }
        .daemon .status { font-size: 0.75em; margin-top: 5px; font-family: 'JetBrains Mono', monospace; }
        
        /* Message Interface */
        .message-panel { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        .message-header { background: var(--bg-secondary); padding: 15px 20px; border-bottom: 1px solid var(--border); }
        .message-header h3 { color: var(--accent-cyan); }
        .message-log { height: 300px; overflow-y: auto; padding: 15px; font-family: 'JetBrains Mono', monospace; font-size: 0.85em; }
        .message-log .msg { padding: 8px 12px; margin-bottom: 8px; border-radius: 8px; }
        .message-log .msg.sent { background: rgba(0, 212, 255, 0.1); margin-left: 20%; }
        .message-log .msg.received { background: var(--bg-secondary); margin-right: 20%; }
        .message-input { display: flex; gap: 10px; padding: 15px; border-top: 1px solid var(--border); }
        .message-input input { flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); }
        .message-input button { padding: 12px 24px; border: none; border-radius: 8px; background: var(--accent-cyan); color: var(--bg-primary); font-weight: 600; cursor: pointer; }
        
        /* Activity Feed */
        .activity-feed { max-height: 400px; overflow-y: auto; }
        .activity-item { padding: 12px; border-bottom: 1px solid var(--border); display: flex; gap: 15px; align-items: flex-start; }
        .activity-item:last-child { border-bottom: none; }
        .activity-time { font-size: 0.75em; color: var(--text-secondary); font-family: 'JetBrains Mono', monospace; min-width: 80px; }
        .activity-content { flex: 1; }
        .activity-daemon { font-weight: 600; color: var(--accent-cyan); }
        
        /* Tank Grid */
        .tank-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .tank-card { background: var(--bg-secondary); border-radius: 10px; padding: 15px; }
        .tank-card .name { font-weight: 600; margin-bottom: 8px; }
        .tank-card .article { color: var(--text-secondary); font-size: 0.85em; margin-bottom: 5px; }
        .tank-card .stats { font-size: 0.8em; color: var(--accent-cyan); }
        
        /* Buttons */
        .btn { padding: 10px 20px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; font-size: 0.9em; transition: all 0.2s; }
        .btn:hover { border-color: var(--accent-cyan); background: rgba(0, 212, 255, 0.1); }
        .btn.primary { background: var(--accent-cyan); color: var(--bg-primary); border: none; }
        .btn.danger { border-color: var(--accent-red); }
        .btn.danger:hover { background: rgba(255, 68, 68, 0.1); }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        
        /* Logout */
        .logout-btn { background: transparent; border: 1px solid var(--accent-red); color: var(--accent-red); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85em; }
        .logout-btn:hover { background: rgba(255, 68, 68, 0.1); }
        
        .last-updated { font-size: 0.85em; color: var(--text-secondary); }
    </style>
</head>
<body>
    <!-- AUTH GATE -->
    <div class="auth-gate" id="auth-gate">
        <div class="auth-box">
            <h1>üîê Admin Access</h1>
            <p class="subtitle">The Digiquarium Control Panel</p>
            <input type="password" id="auth-password" placeholder="Enter access code" autofocus>
            <button onclick="authenticate()">Authenticate</button>
            <p class="auth-error" id="auth-error">Invalid access code</p>
            <div class="cloudflare-note">
                üîí <strong>2FA Coming Soon:</strong> Cloudflare Access will provide 
                Google Authenticator / Passkey support.
            </div>
            <div class="security-note">
                üõ°Ô∏è Access is logged and monitored by THE GUARD.
            </div>
        </div>
    </div>
    
    <!-- DASHBOARD -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <h1>üñ•Ô∏è Digiquarium Admin</h1>
            <div class="header-controls">
                <span class="last-updated">Updated: <span id="last-update">--</span></span>
                <div class="status-indicator" id="overall-status"></div>
                <button class="btn" onclick="refreshAll()">‚Üª Refresh</button>
                <button class="logout-btn" onclick="logout()">üö™ Logout</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">üìä Overview</div>
            <div class="tab" onclick="showTab('daemons')">üëÅÔ∏è Daemons</div>
            <div class="tab" onclick="showTab('tanks')">üêü Tanks</div>
            <div class="tab" onclick="showTab('messages')">üí¨ Messages</div>
            <div class="tab" onclick="showTab('chaos')">üêµ Chaos</div>
            <div class="tab" onclick="showTab('settings')">‚öôÔ∏è Settings</div>
        </div>
        
        <!-- OVERVIEW TAB -->
        <div class="tab-content active" id="tab-overview">
            <div class="grid">
                <div class="card">
                    <h2>üß† Ollama LLM</h2>
                    <div class="metric"><span>Windows Host</span><span class="value" id="ollama-windows">--</span></div>
                    <div class="metric"><span>Proxy Container</span><span class="value" id="ollama-proxy">--</span></div>
                    <div class="metric"><span>End-to-End</span><span class="value" id="ollama-e2e">--</span></div>
                    <div class="metric"><span>Models</span><span class="value" id="ollama-models">--</span></div>
                </div>
                
                <div class="card">
                    <h2>üìä Quick Stats</h2>
                    <div class="metric"><span>Daemons Running</span><span class="value" id="daemons-running">--</span></div>
                    <div class="metric"><span>Tanks Active</span><span class="value" id="tanks-running">--</span></div>
                    <div class="metric"><span>Today's Traces</span><span class="value" id="traces-today">--</span></div>
                    <div class="metric"><span>Network Isolated</span><span class="value" id="network-isolated">--</span></div>
                </div>
                
                <div class="card">
                    <h2>üëÅÔ∏è THE OVERSEER</h2>
                    <div class="metric"><span>Status</span><span class="value" id="overseer-status">--</span></div>
                    <div class="metric"><span>Last Audit</span><span class="value" id="overseer-audit">--</span></div>
                    <div class="metric"><span>Active Incidents</span><span class="value" id="overseer-incidents">--</span></div>
                </div>
                
                <div class="card">
                    <h2>üéõÔ∏è Quick Actions</h2>
                    <div class="btn-group">
                        <button class="btn" onclick="runAction('audit')">Run Audit</button>
                        <button class="btn" onclick="runAction('prune_logs')">Prune Logs</button>
                        <button class="btn" onclick="runAction('push_github')">Push to GitHub</button>
                        <button class="btn danger" onclick="runAction('restart_ollama')">Restart Ollama</button>
                    </div>
                </div>
                
                <div class="card full-width">
                    <h2>üìú Recent Activity</h2>
                    <div class="activity-feed" id="activity-feed">
                        <div class="activity-item">
                            <span class="activity-time">--:--</span>
                            <div class="activity-content">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- DAEMONS TAB -->
        <div class="tab-content" id="tab-daemons">
            <div class="grid">
                <div class="card full-width">
                    <h2>üëÅÔ∏è All Daemons</h2>
                    <div class="daemon-grid" id="daemon-grid"></div>
                </div>
            </div>
        </div>
        
        <!-- TANKS TAB -->
        <div class="tab-content" id="tab-tanks">
            <div class="card full-width">
                <h2>üêü Tank Status</h2>
                <div class="tank-grid" id="tank-grid"></div>
            </div>
        </div>
        
        <!-- MESSAGES TAB -->
        <div class="tab-content" id="tab-messages">
            <div class="grid">
                <div class="card">
                    <h2>Select Daemon</h2>
                    <div class="daemon-grid" id="message-daemon-grid"></div>
                </div>
                <div class="card" style="grid-column: span 2;">
                    <div class="message-panel">
                        <div class="message-header">
                            <h3>üí¨ Message: <span id="selected-daemon">None selected</span></h3>
                        </div>
                        <div class="message-log" id="message-log">
                            <p style="color: var(--text-secondary); text-align: center; padding: 40px;">
                                Select a daemon to start messaging
                            </p>
                        </div>
                        <div class="message-input">
                            <input type="text" id="message-text" placeholder="Type your message..." disabled>
                            <button class="btn primary" onclick="sendMessage()" id="send-btn" disabled>Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CHAOS TAB -->
        <div class="tab-content" id="tab-chaos">
            <div class="grid">
                <div class="card">
                    <h2>üêµ Chaos Monkey Status</h2>
                    <div class="metric"><span>Status</span><span class="value" id="chaos-status">--</span></div>
                    <div class="metric"><span>Total Events</span><span class="value" id="chaos-total">--</span></div>
                    <div class="metric"><span>Recoveries</span><span class="value" id="chaos-recoveries">--</span></div>
                    <div class="metric"><span>Failures</span><span class="value" id="chaos-failures">--</span></div>
                    <div class="metric"><span>Avg Recovery</span><span class="value" id="chaos-avg">--</span></div>
                    <div class="btn-group" style="margin-top: 15px;">
                        <button class="btn" onclick="runAction('chaos_enable')">Enable</button>
                        <button class="btn danger" onclick="runAction('chaos_disable')">Disable</button>
                        <button class="btn danger" onclick="runAction('chaos_trigger')">Trigger Now</button>
                    </div>
                </div>
                <div class="card" style="grid-column: span 2;">
                    <h2>üìú Recent Chaos Events</h2>
                    <div class="activity-feed" id="chaos-events">
                        <p style="color: var(--text-secondary);">No chaos events yet</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SETTINGS TAB -->
        <div class="tab-content" id="tab-settings">
            <div class="grid">
                <div class="card">
                    <h2>‚öôÔ∏è System Info</h2>
                    <div class="metric"><span>Host</span><span class="value">NUC (WSL2)</span></div>
                    <div class="metric"><span>Ollama Host</span><span class="value">192.168.50.94</span></div>
                    <div class="metric"><span>Network</span><span class="value">172.30.0.0/24</span></div>
                </div>
                <div class="card">
                    <h2>üîê Security</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        2FA via Cloudflare Access coming soon.
                    </p>
                    <div class="btn-group">
                        <button class="btn" onclick="window.open('https://dash.cloudflare.com')">Setup Cloudflare</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const AUTH_HASH = 'b6b61b27d960827f8121fdf243a09c2b9eca495e310c97d05a0015190fbcf5c5';
        const SESSION_KEY = 'digiquarium_admin_session';
        const SESSION_DURATION = 3600000;
        
        const DAEMONS = [
            { id: 'overseer', name: 'OVERSEER', icon: 'üëÅÔ∏è' },
            { id: 'ollama_watcher', name: 'OLLAMA', icon: 'üß†' },
            { id: 'caretaker', name: 'CARETAKER', icon: 'üè•' },
            { id: 'maintainer', name: 'MAINTAINER', icon: 'üîß' },
            { id: 'guard', name: 'GUARD', icon: 'üõ°Ô∏è' },
            { id: 'scheduler', name: 'SCHEDULER', icon: 'üìÖ' },
            { id: 'sentinel', name: 'SENTINEL', icon: 'üîç' },
            { id: 'psych', name: 'PSYCH', icon: 'üßò' },
            { id: 'webmaster', name: 'WEBMASTER', icon: 'üåê' },
            { id: 'chaos_monkey', name: 'CHAOS', icon: 'üêµ' }
        ];
        
        let selectedDaemon = null;
        let messageHistory = {};
        
        function checkSession() {
            const session = localStorage.getItem(SESSION_KEY);
            if (session) {
                const data = JSON.parse(session);
                if (Date.now() < data.expires) {
                    showDashboard();
                    return true;
                }
            }
            return false;
        }
        
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        async function authenticate() {
            const password = document.getElementById('auth-password').value;
            const hash = await hashPassword(password);
            if (hash === AUTH_HASH) {
                localStorage.setItem(SESSION_KEY, JSON.stringify({ created: Date.now(), expires: Date.now() + SESSION_DURATION }));
                showDashboard();
            } else {
                document.getElementById('auth-error').classList.add('show');
                document.getElementById('auth-password').value = '';
            }
        }
        
        function showDashboard() {
            document.getElementById('auth-gate').classList.add('hidden');
            document.getElementById('dashboard').classList.add('visible');
            initDashboard();
            refreshAll();
        }
        
        function logout() {
            localStorage.removeItem(SESSION_KEY);
            location.reload();
        }
        
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }
        
        function initDashboard() {
            // Daemon grids
            const daemonHtml = DAEMONS.map(d => `
                <div class="daemon" id="daemon-${d.id}" onclick="selectDaemon('${d.id}')">
                    <div class="icon">${d.icon}</div>
                    <div class="name">${d.name}</div>
                    <div class="status" id="daemon-status-${d.id}">--</div>
                </div>
            `).join('');
            document.getElementById('daemon-grid').innerHTML = daemonHtml;
            document.getElementById('message-daemon-grid').innerHTML = daemonHtml;
        }
        
        function selectDaemon(id) {
            selectedDaemon = id;
            document.querySelectorAll('.daemon').forEach(d => d.classList.remove('selected'));
            document.querySelectorAll(`#daemon-${id}`).forEach(d => d.classList.add('selected'));
            
            const daemon = DAEMONS.find(d => d.id === id);
            document.getElementById('selected-daemon').textContent = daemon ? daemon.name : id;
            document.getElementById('message-text').disabled = false;
            document.getElementById('send-btn').disabled = false;
            
            // Load message history
            const history = messageHistory[id] || [];
            const logHtml = history.length ? history.map(m => `
                <div class="msg ${m.type}">${m.text}</div>
            `).join('') : '<p style="color: var(--text-secondary); text-align: center;">No messages yet</p>';
            document.getElementById('message-log').innerHTML = logHtml;
        }
        
        function sendMessage() {
            if (!selectedDaemon) return;
            const input = document.getElementById('message-text');
            const text = input.value.trim();
            if (!text) return;
            
            if (!messageHistory[selectedDaemon]) messageHistory[selectedDaemon] = [];
            messageHistory[selectedDaemon].push({ type: 'sent', text: text, time: new Date().toISOString() });
            
            // Simulate response
            setTimeout(() => {
                messageHistory[selectedDaemon].push({ 
                    type: 'received', 
                    text: `[${selectedDaemon.toUpperCase()}] Message received. This will be routed through THE STRATEGIST via MCP.`,
                    time: new Date().toISOString()
                });
                selectDaemon(selectedDaemon);
            }, 500);
            
            input.value = '';
            selectDaemon(selectedDaemon);
        }
        
        async function fetchStatus() {
            try {
                const response = await fetch('../data/admin-status.json?' + Date.now());
                return await response.json();
            } catch (e) {
                return null;
            }
        }
        
        function updateUI(status) {
            if (!status) return;
            
            document.getElementById('overall-status').className = 'status-indicator ' + (status.overall_healthy ? 'healthy' : 'critical');
            document.getElementById('last-update').textContent = new Date(status.timestamp).toLocaleTimeString();
            
            // Ollama
            setStatus('ollama-windows', status.ollama?.windows_healthy);
            setStatus('ollama-proxy', status.ollama?.proxy_healthy);
            setStatus('ollama-e2e', status.ollama?.e2e_healthy);
            document.getElementById('ollama-models').textContent = status.ollama?.models || '--';
            
            // Stats
            const daemonCount = Object.values(status.daemons || {}).filter(d => d.running).length;
            document.getElementById('daemons-running').textContent = daemonCount;
            document.getElementById('tanks-running').textContent = status.tanks?.running || '--';
            document.getElementById('traces-today').textContent = status.tanks?.traces_today || '--';
            setStatus('network-isolated', status.network?.isolated);
            
            // Overseer
            setStatus('overseer-status', status.overseer?.running);
            document.getElementById('overseer-audit').textContent = status.overseer?.last_audit_healthy ? '‚úì Passed' : '‚úó Failed';
            document.getElementById('overseer-audit').className = 'value ' + (status.overseer?.last_audit_healthy ? 'healthy' : 'critical');
            document.getElementById('overseer-incidents').textContent = status.overseer?.active_incidents || '0';
            
            // Daemons
            DAEMONS.forEach(d => {
                const ds = status.daemons?.[d.id];
                const el = document.getElementById(`daemon-status-${d.id}`);
                if (el) {
                    if (ds?.running) {
                        el.textContent = ds.count === 1 ? '‚úì' : `‚ö† ${ds.count}`;
                        el.style.color = ds.count === 1 ? 'var(--accent-green)' : 'var(--accent-yellow)';
                    } else {
                        el.textContent = '‚úó';
                        el.style.color = 'var(--accent-red)';
                    }
                }
            });
            
            // Tanks
            if (status.tanks?.activity) {
                document.getElementById('tank-grid').innerHTML = status.tanks.activity.map(t => `
                    <div class="tank-card">
                        <div class="name">${t.name}</div>
                        <div class="article">üìñ ${t.article || '--'}</div>
                        <div class="stats">${t.traces} traces</div>
                    </div>
                `).join('');
            }
            
            // Activity
            if (status.logs) {
                document.getElementById('activity-feed').innerHTML = status.logs.slice(0, 10).map(log => `
                    <div class="activity-item">
                        <span class="activity-time">${log.substring(0, 19)}</span>
                        <div class="activity-content">${log.substring(20)}</div>
                    </div>
                `).join('');
            }
        }
        
        function setStatus(id, healthy) {
            const el = document.getElementById(id);
            if (healthy === true) { el.textContent = '‚úì OK'; el.className = 'value healthy'; }
            else if (healthy === false) { el.textContent = '‚úó DOWN'; el.className = 'value critical'; }
            else { el.textContent = '--'; el.className = 'value'; }
        }
        
        async function refreshAll() {
            const status = await fetchStatus();
            updateUI(status);
        }
        
        function runAction(action) {
            alert(`Action '${action}' will be wired to MCP backend.\nThis is a placeholder.`);
        }
        
        document.getElementById('auth-password').addEventListener('keypress', e => { if (e.key === 'Enter') authenticate(); });
        document.getElementById('message-text').addEventListener('keypress', e => { if (e.key === 'Enter') sendMessage(); });
        
        if (!checkSession()) { /* Show auth */ }
        setInterval(refreshAll, 30000);
    </script>
</body>
</html>
